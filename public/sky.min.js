const skylight=(e,t=!1)=>{const a=t?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${a}>${(o=>{const n={quote:!0,bold:!0,italic:!0};var e=(e,t,a)=>{for(;-1<o.indexOf(e);)o=n[t]?o.replace(e,`<${a}>`):o.replace(e,`</${a}>`),n[t]=!n[t]},t=(t,a)=>o=o.split("\n").map(e=>0===e.trimStart().indexOf(t)?`<${a}>${e.replace(t,"")}</${a}>`:e).join("\n");return t("#### ","h4"),t("### ","h3"),t("## ","h2"),t("# ","h1"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i"),o=o.trim()})(e)}</${a}>`).join("")};let g$={},c$={};Game.loon={name:"green man",location:"nearSwamp",exitText:"Nice chatting with you",notMet:()=>`
  
  A funny little green man is half sunk into the sludge, wearing a
  white laboratory cardigan and excitedly filling test tubes with 
  muck. He appears to be having a good time, at any rate.
  
  `,desc:{talk:"Professor Loon is still here, gathering more sludge into tubes. ",annoyed:"Professor Loon is in mud, looking very annoyed about something"},talk:()=>{msg([`

    "Greetings!" said the green man. His eyes focus on you intently, big and black like a housefly's. "My name is Loon. Professor Loon, zoologist!
    You're just in time!"

    He appears to be standing directly over a large, useful-looking metal crank.
            
    `,`
    
    Professor Loon waves a test tube cheerfully in your direction. He appears to be standing
    directly over a large, useful-looking metal crank.
            
    `]),setName("Loon"),once({"Just in time for what?":()=>{msg(`
        
        "Why, the discovery of a new species!" said Loon with a vast grin. "I, Professor Loon, have discovered a new form of life!"
        
        `),btn({"Is that so?":`
        
        "Yes!" He scoops more and more sludge into tubes, which he stuffs into his apparently limitless cardigan. "Soon, I will be ready to share
        my discovery with the galaxy! At least, while there's still a galaxy to share it with."

      `}),btn({"What is it?":`
        
        "I can't reveal that yet," said Loon, "But I will very soon!"

      `})}}),hasSaid("Just in")&&btn({"You really can't even give me a tiny hint what you're working on?":()=>{msg([`
    
      Loon examines you with a mischievous glint in his eye. "Two words: musical... chiggers!"
    
      `,`

      "I fear I've said too much already," said Loon.
      
      `])}}),once({"Nice to meet you":`
    
    "Professor Thelonius Moon Loon, at your service!" He gave a fast wink. "Nice to meet a fellow adventurer. I suppose you came down in that
    ship the crashed earlier today!"
    
    `}),btn({"Loon is an unusual name, where are you from?":`
    
    "Oh, us Loons have been all over the galaxy for thousands of years. There's been Loons in politics, Loons in academia... And, chances are,
    if you've ever been on the Internet, you've met a few Loons."
    
    `}),btn({"Hey, can I see that crank for a second?":()=>{msg(`
        
        "Of course," said Loon, "Except that I can't move a muscle! Even the slightest
        disruption could be a disaster to science!"

        `),btn({"Please? I promise I won't hurt your experiment!":`
        
        "Even the very *slightest* movement could ruin years of work!" cried Loon.
        "I can't stop now, even if the universe itself were ending!"
        
        `}),btn({"I don't think you're going to find anything tromping in the mud anyway":`
        
        "Ha!" scoffed Loon. "That's what they told Jed Clampett!"
        
        `}),btn({"Fine. Be that way":`

        "We all make sacrifices for the sake of science, my friend," nods Loon.
        
        `})}}),hasMet("merrick")&&hasSaid("Just in")&&btn({"You know, that Merrick guy at the festival seems like quite a scientist himself":()=>{msg(`
          
          Loon snorts. "I can assure you, my friend, Merrick is *no* scientist of any sort."
          
          `),btn({"I don't know. He seems on the edge of a breakthrough!":()=>{msg(`
            
            Loon suddenly appears to be very nervous. "Hmmm. Wouldn't hurt to take a break
            and head down to the festival, I suppose. Excuse me."

            He dashes off in a huff.

            `),setLocation(""),setState("annoyed"),done("Well OK then")}}),btn({"If you say so":`
          
          "I'm not worried about competing with that so-called mixologist,"
          said Loon with a chuckle. "We're doing actual science here."
          
          `})}}),done("Have a good day scooping mud")},annoyed:()=>{msg(`
    
    "I'm not in the mood to chat right now," said Loon with a scowl.
    
    `),done("Alrighty")}},Game.mavis={name:"giant brain in a jar",exitText:"Thanks for your help",location:"library",superMegaBlastLearning:!1,bookAskCount:0,notMet:()=>`
    
    In the corner, a giant brain in a tall cylindrical jar stands
    attached to a long panel of dials and lights. Beneath the glass is a small
    brass plaque which reads: "The Librarian."
    
    `,desc:()=>`
    
    Mavis regards you with a slight throbbing of her prefrontal lobe.
    
    `,talk:()=>{msg([`
        
        "Greetings, traveler," said the humongous brain. "My name is Mavis. I am the
        librarian of this facility."
        
        `,`
        
        "Welcome, traveler," said Mavis. "How can I guide your cerebral journeys today?" 
        
        `]),btn({"Why haven't you got any books?":()=>{c$.bookAskCount<2&&(c$.bookAskCount+=1),msg([`
            
            "Our collection is all around you," said Mavis with a pulse of her choroid plexus.
            "Books, on paper, are archaic and wear out. We here on Snorlag consume literature
            through subharmonic vibrations emitting from the crystals in the walls around you.
            Though, I understand how hard it can be for a limited organism like yourself 
            to engage with such an experience.
            
            `,`
            
            "I told you," said Mavis. "The collection exists in vibrations from the crystals,
            not pulped on dead plant life. Though, you might be able to use the Super MegaBlast
            Learning Hat.
            
            `])}}),hasSaid("any books")&&btn({"Are you sure you don''t have any books?":`
        
        "It's not that kind of library," said Mavis.
        
        `}),1<c$.bookAskCount&&btn({"What's the Super MegaBlast Learning Hat?":()=>{c$.superMegaBlastLearning=!0,msg(`"I shouldn't even mention it," said Mavis, "Because even if you survive
                it, you'll lose everything you learned in like half an hour.`)}}),0<timesPressed("What's the Super MegaBlast Learning Hat?")&&btn({"Let me try the hat!":['"You could fry your brain, human," said Mavis.',`"I'm serious about the whole brain-frying thing," said Mavis with a growing
                    edge in her voice.`,()=>{msg("Ok, you've had it!")}]}),done(c$.exitText)}},Game.merrick={name:"frat scientist",location:"festival",exitText:"Uh, carry on I guess",desc:()=>{hasMet("merrick")?msg(`
          
          Merrick is here, mixing new cocktails as though his life depended on it.
          
        `):msg(`
          
          A frat boy with no eyes and a huge antenna dressed as a scientist is busily mixing drinks at the bar.
          He appears to be very serious about what he's doing.
          
          `)},talk:()=>{msg([`

        The frat scientist regards you very studiously. "Welcome, party-goer," he said spreading his appendages. "Welcome to the end
        of the universe. I, Merrick, am a skilled mixologist, and perhaps your last chance at a good time before it's all over."

              
      `,`
      
        Merrick seems too absorbed in his laboring over the cocktail bar to give you too much attention.
              
      `]),setName("Merrick"),btn({"Are you working the bar all by yourself?":`
      
      "To be a mixologist is to be alone," said Merrick with distinguished air. "Of course, as
      a researcher, I have contemporaries. You may have already met Professor Loon." He sniffs.
      "In fact, Loon is really more of a rival than any kind of close friend."
      
      `}),btn({"What are you mixing?":()=>{msg(`
        
        "The greatest cocktail in the history of our time-space continuum," said Merrick with an air of mystery.
        "Perhaps, in this twilight of our existence, we shall bear witness to the last great
        work of quaffable art. Soon, my greatest discovery will be unleashed at this very party."
        
        `),btn({"Let me try it":()=>{msg(`

          You take a sip...
          
          A crushing wave from the hollow of your soul emerges, rising higher and higher,
          while Strauss' Thus Spoke Zarathustra played on hundred theremins reaches a crescendo in
          your head...
          
          `),btn({"Blarrf!":()=>{msg(`
            
            You take one sip, and then another. Not bad!
            
            [Your overall life span has decreased by several minutes.]
            
            `)}}),btn({"Huuurggg!":()=>{msg('"Not perfect yet," mumbled Merrick. "Needs more absinthe and strychnine."')}}),btn({"Excuse me. Can you direct me to the nearest bipedal-friendly porcelain commode?":()=>{msg(`Merrick slowly transforms into an enormous Kafkaesque toilet. "What did you
            say again?" he asked. His seat and lid were acting as a tongue and mouth.`)}})}}),btn({"It looks like scummy swamp water":`
        
        "Wow, you're a mixologist as well?" said Merrick, obviously impressed. "Not bad."
        
        `})}}),done(c$.exitText)}},Game.rebnah={exitText:"Nice chatting with you",hasTheToken:!1,location:"cityEntrance",name:"greeter hologram",talkLabel:()=>{var[e,,t,,]=getName("rebnah");return`Chat with ${t} `+e},notMet:()=>{return`
            
      One of those weird greeter holograms has popped out of thin air. She has numerous arms in inconvenient places and a noggin which resembles that of a reasonably pleased purple rhinoceros.
            
      `},desc:()=>`
              
        Rebnah the greeter hologram waves to you cheerily, which is impressive considering her vast quantity of arms. ${roll(25)?`She 
              emits a thunderous snort and rubs her fantastic nose.`:""}
              
    `,talk:()=>{c$.hasTheToken=!0,msg([`
  
        "Welcome, greetings, and many happy *frojniks* to you, off-worlder!" said the hologram with a smile. She wears a hat
        with the words Ask Me About My Home Planet embroidered in large red letters.
  
        "I welcome you to Planet Snorlag, the friendliest world this side of Mutter's Third Arm! My name is Rebnah—pleased to meet you! I am
        here to make sure your stay is simply Snor-tastic!"
  
        With a wave of her suckered hand, something cold and metallic materializes in your pocket. "Be sure to read the fine print on that token!" she said.
          
      `,`
          
        Rebnah the hologram watches you with great enthusiasm. "What can I do to make your stay even more *Snor*-mazing?"
          
      `]),setName("Rebnah"),btn({"Tell me about your home planet":()=>{msg([`
        
        "Oh boy, I can't wait to tell you all about SNORLAG!" said Rebnah with breathless enthusiasm. “Though, there's not much happening right
        now. You see, the two primary species of this planet—Kevoriians and Zogtarians—are at odds with each other and they've reached a stalemate.
        The Kevoriians have a Reality-Time Detonator, which will wipe out all life in the universe, and the Zogtarians have a Time-Reality Disruptor,
        which will prevent all life from ever existing in the first place.
        
        “So there's nobody really here right now, everybody is down at the festival trying to get one last party in before all of
        time and space crashes in on itself.”
        
        `,`
  
        “Not much happening today. The Kevoriians and Zogtarians are about to destroy us all.
        The Kevoriians have a Reality-Time Detonator, which will wipe out all life in the universe, and the Zogtarians have a Time-Reality Disruptor,
        which will prevent all life from ever existing in the first place.
        
        “So everybody is down at the festival trying to get one last party in. I'm a hologram, so technically I never existed in the first place.”
        
        `])}}),btn({"What species are you?":`
      
      "I'm a hologram, and not designed to mimic one species per se. Actually, my physical form was designed by committee. They gave me the
      most arms ever, so I give the best hugs!" She pauses and looks down at her numerous appendages. "Though, I'll admit, finding
      compatible sweaters is a challenge."
      
    `}),c$.hasTheToken&&once({"Read the token":`
                  
            ADMIT TWO FOR COMPLIMENTARY SHOW AT SNORLAGIAN CINEMAS
  
            Down below, in the fine print, you notice the token expired around ten Earth years ago.
  
            Rebnah spies you reading the token. "Not bad, huh? Sounds like a great time when you make a new friend on our 
            planet!" Then she leans in close. "Strictly between you and me, never date a Kevoriian. They're technically mollusks,
            and their ichorous secretions are poisonous to humanoids. Also, they're slimy kissers.
                  
          `}),done("See you later")},afterShipDestroyed:()=>{msg(`
              
    Rebnah the greeter hologram offers a wan smile, seemingly aware that you're having a rough day.
    
    `),btn({"Do you just pop in and out of existence like that all the time?":()=>{c$.exitText="Well, it's been a... pleasure, I guess",msg(`
      
      "Oh no." Rebnah's gaze turned dark. "Being stored in computer memory is like torture. Imagine an eternity of suffering, never living
      but never really dying, where every inch of your person is in unimaginable pain, and your internal 
      organs are jostled inside you like hot rocks and battery acid in a blender."
      
      `),btn({"That's... horrific...":`
      
          "Yeah but you get used to it."
      
          `})}}),done(c$.exitText)}},Game.spaceKing={preventWar:!1,name:"man",talk:()=>{setName("Space King"),msg([`
        
        A man stands before you, but more than merely a man. He reminds you of a mix of Hercules and Adonis, only ten times more
        ripped. His solemn expression smacks of both seriousness and kind benevolence.

        "Greetings," he said in rich theatrical tones. He paused for effect. "I am a nearly omnipotent entity in a form you are
        assuredly comfortable with. My name... is Space King."

        The stars above seem to whisper "Space King" in hushed tones as he says the words.
        
      `,`
        
        Space King stands before you, clad in a magnificent chartreuse toga. He favors you with a gaze of kindly regard befitting a much lesser life form.

      `]),once({"Never heard of you":`
        
        Space King's eyes light with a kind of greenish fire that gives you a slight tremble. "Well," he said, "Like as not, I'm very important."
        
        `}),btn({"Nice to meet you":`
        
        "It is, isn't it," said Space King. "It is very nice to meet me, of course. I'm thinking of adding a dash to my name. You know,
        Space-King. It sounds more grand and purposeful." His hair blows majestically in the wind.
        
        `}),once({"What's the most impressive thing you've ever done?":()=>{msg(`
        
        Space King scratches his chin. "I could spend many of your lifetimes narrowing my finest accomplishments into a manageable form
        for the likes of you. But, here's a quick one. I once made an entirely sentient pie."
        
        `),btn({"Did you have the moral right to create a living thing?":()=>{msg(`
          
          "I don't know," responded the Space King, "But, I do know this: he was delicious."
          
          `)}}),btn({"What kind of pie was it?":()=>{msg(`
          
          "I already told you, it was a *sentient*—oh, you mean the filling. Banana creme, the noblest of
          all pies."
          
          `)}})}}),c$.preventWar&&btn({"So what are you doing to prevent war?":`
              
        "Sadly, very little at the moment," said Space King, "For my rheumatism is getting the better of me right now.
        That's why I'm standing by this lake, attempting to get some fresh air."
              
      `}),once({"What are you doing *here* of all places?":()=>{c$.preventWar=!0,msg(`
        
        "A fair question," nodded Space King. “After all, why should a being of my incredible talent be relegated to dealing with such limited
        mortals?

        “Well, the answer is simple. Any second, war will erupt on this planet that will engulf the universe. My role is to prevent billions
        from dying. The catastrophe about to take place is potentially greater than that of Smellus IV.”
        
        `),btn({"Smellus IV?":`
        
        “Ah, Smellus IV. The indigenous creatures had no vocal cords, so their whole civilization learned to communicate with finely 
        honed intestinal odors. In a stupendously bad bit of schedule overlap, the Great Interstellar Peace Talks on Smellus took place on
        Taco Tuesday.

        “Then, in an attempt to resume the Talks, a well-intentioned but misguided diplomat purchased an elaborate catered lunch
        for the entire event, from Arby's.” Space King shook his head. "Tragic." 
        
      `})}}),done("A pleasure to talk to you, oh Space King")}},Game.yates={askedAboutName:!1,talk:()=>{c$.askedAboutName;msg(`
          
        Yates is (literally) your second hand man; a 50/50 medley of robotic and organic components, cobbled into a hodge-podge of an android. 
        The bio stuff is cut-rate, to say the least, likely because he sustains every six hours or so with junk food and their abundant hydrocarbons.
        Thus, he constantly smells vaguely of processed cheese dust.
    
        Presently, he's trying to salvage what's left of your engine, landing gear, and
        emergency seagull repellent.
          
        `),btn({"Tell me again why your name is Yates":()=>{c$.askedAboutName=!0,msg(`
                  
            "Actually," said Yates, "My true designation is Cybernetic Reploid model 88, or CR-88.
            My first owner called my Crazy 8's, then my next owner called
            me Eights, and finally the last one called my Yates."
        `)}}),btn({"Will you hurry up already?":()=>{setState("annoyed"),msg(`"I'm working as fast as I can," he grumbled.`)}}),done("Well, keep working, we've got to get off this rock",()=>{msg("Yates nods and buries himself in repair work. A shadow of paranoia crosses your mind that he may not know what he's doing.")})},annoyed:()=>{msg(`
      
      Yates glares at you as he keeps working. He seemed pretty annoyed.
      
      `),btn({"Can't you work any faster?":`
      
      "I don't want to be stuck on this stupid planet, either," said Yates with a sour look.
      
    `}),btn({"Thank you for working so hard, Yates":()=>{setState(),msg(`
        
        "Thanks. I'm going as fast as I can."
        
        `)}}),done("Well, keep working, we've got to get off this rock")}},Game.caveMouth=()=>{msg(`
    
    An ominous dark hole in the side of the mountain opens near the fringe of the swamp.
    The shadows within seem somehow blacker and more intense than normal.

    `),btn({"Enter the cave":()=>{getVal("caveForceFieldOff")?go("insideCave")():msg(`
            
            OOF! As you approach the cave, you feel drawn in by an unseen force, then
            lifted off the ground, and finally dropped in mid-air exactly three meters
            to the left.
            
            `)}}),btn({"Return to the swamp":go("nearSwamp")})},Game.city=()=>{msg(`
          
    A narrow metal road runs in straight paths between squat stucco buildings. The streets are deserted, though you can
    hear sounds of a party nearby. Posted over the street sign is hastily scrawled message on what appears to be
    white party supply paper. 
          
    `),env(()=>roll(25)&&pick(["Boom! Boom! Boom! The base from the micro-sized festival echoes down the street.",`You can hear what sounds like tiny screams from the festival ahead. Either people are
      depressed over the end of the universe or they're having a pretty good time.`,"The music peaks from the festival, followed by a small but thunderous cheer."])),btn({"Read the hastily scrawled sign":`
    
      <center>THE LAST PARTY AT THE END OF THE UNIVERSE STRAIGHT AHEAD</center>

      Warning: pregnant women and Ungarians with live eggs should not enter compression fields.
    
    `}),btn({"Find the repair shop":go("shipRepairShop")}),btn({"Enter the library":go("library")}),btn({"Walk to the festival":()=>{msg(`Your skin tingles a bit as you pass through a compression field and
      are shrunk to a couple of millimeters tall
      so as to enter the venue.`),btn({"Hey that tickles":go("festival")})}}),btn({"Leave the village":go("cityEntrance")})},Game.cityEntrance=()=>{msg(`
        
        Tall white stone walls stand gleaming the sun,
        surrounded by a thin brown line of moat. A narrow bridge
        leads to an arched open gate in the wall made of brass and crystal.
        The path forks off to a lake, over which floats a 1000 meter tall sign.
        
    `),env(()=>roll(25)&&pick(["A door quietly shuts somewhere beyond the wall.","The wind whips just enough around the walls to produce a low, sad whistle."])),once({"Read the 1000 meter tall sign":`
    The writing is small, you'll have to get closer by heading towards the lake.
  `}),btn({"Head up the hill":go("outsideShip")}),btn({"Follow the path to the lake":go("lakeSide")}),btn({"Enter the village":go("city")})},Game.festival=()=>{msg(`
          
    A vast crowd numbering into the millions, with every species you've ever
    heard of and a few you haven't, dance and drink furiously
    for one last big hoo-hah.
    A repurposed shipping crate is used as the venue, and inside the compression field, you 
    and your fellow revelers find it larger than an ampitheater.
          
    `),env(()=>roll(25)&&pick(["An explosion of confetti fills the air, with several colored bits landing on your face.","The crowd cheers, as though someone either drank another flight or passed out."])),btn({"Dance with the crowd":`

    OOF! OUCH! HMPH! Arms, tentacles, and other miscellaneous appendages
    flail into your carbon-based biology as you attempt to cut a rug.
  
  `}),btn({"Listen to the music":`
    
    It's tough to hear any lyrics, but it sounds like the ${pick([`3rd Movement of Parnassor the Tuneless Suicidal on the Great Ending of Everything Ever.
        Either that, or it's another remake of that Sister Sledge song.`,"Whistling Beaked Monks of Planet Shnoz. They were really big on Snotify last year.",`Beethoven's 5th. Not *the* Beethoven, though—the other one, a clone of Beethoven who
        wrote only polkas.`])}
  
  `}),btn({"Leave the festival":go("city")})},Game.lakeSide=()=>{var[e,t,a]=getName("spaceKing"),o={};o[getTalkLabel("spaceKing")]=talk("spaceKing"),msg(`
    
    At the bottom of the valley by the village is a clear, blue lake. Over the lake is an enormous sign, so massive
    it cannot possibly be floating on its own but appears to be doing so effortlessly.
    Standing directly underneath the sign, near the water, is ${t}
    ${e}. Back up the path is the village, and not far along the shore the lake muddies into a swamp.

  `),env(()=>roll(25)&&pick(["The wind creates soft little ripples over the lake.","A gentle breeze blows peacefully.","Some distant animal squawks mournfully from the valley below."])),btn({"Read the incredible sign":`
  
    The vast sign says in every known language in the universe, including ✧❖➶⨇⨖⨿⩉:
  
    **Here He Is**

    A gigantic red arrow points to ${a} ${e}.
  
  `}),btn(o),btn({"Climb back up towards the village":go("cityEntrance")}),btn({"Enter the swamp":go("nearSwamp")})},Game.library=()=>{msg(`
    
    Golden sunlight filters in from an oculus at the top of a vast dome, which is 
    almost entirely empty. Crystals of a variety of colors line the walls, and if you listen,
    you can hear them hum ever so gently.
    
    `),btn({"Listen to the hum":`
    
        The hum of the crystals fills your ears with a kind of aural radiance, like Yanni
        and Enya playing at full volume in the same room.
    
    `}),btn({"Exit the library":go("city")})},Game.nearSwamp=()=>{msg(`
          
          The lake ebbs here into a greenish-brown mire, which on this end bubbles vigorously with sulfur. A trail runs along the swamp from
          the lake to a small cave. 
          
      `),"nearSwamp"!==getLocation("loon")&&(msg(`
      
      On the exact spot where Loon was standing is a large metal crank in the mud
      labeled *FORCE FIELD CONTROL*.

      `),btn({"Turn crank":()=>{setVal("caveForceFieldOff",!0),msg(`
        
        The force field control is now in the off position.
        
        `)}})),env(()=>roll(25)&&pick(["A particularly large bubble pops, filling the air with stench.","A loud POP carries over the water as another bubble explodes."])),btn({"Head towards the cave":go("caveMouth",()=>{getVal("caveForceFieldOff")&&setLocation("nearSwamp",loon)})}),btn({"Go to the clean part of the lake":go("lakeSide",()=>{getVal("caveForceFieldOff")&&setLocation("nearSwamp",loon)})})},Game.myShip={stillHere:!0},Game.cockpit=()=>{msg(`
          
    Your command chair is surrounded by an array of screens, lights and controls telling you every detail
    of what's happening on your ship. Right now, they're all very upset for some reason. A distant alarm
    echoes from the engine cavity. A sturdy metal ladder descends to the main deck.
  
    `),btn({"Climb down to the Main Deck":go("mainDeck")}),btn({"Sit in the chair":"You sit in the command chair and feel very heroic."}),btn({"Look out the window":"The purple sky and distant golden mountains don't resemble any planet you've visited before."})},Game.mainDeck=()=>{msg(`
      
    This part of the ship is the least damaged—it's a pretty good thing you were here during the crash. The hyper-sleep pod is depowered,
    along with most everything else on this deck. Yates will probably have all the systems on and off about a hundred times before
    we can limp to a repair shop.
      
    `),btn({"Go to the cockpit":go("cockpit")}),btn({"Exit the ship":go("outsideShip")})},Game.outsideShip=()=>{msg(`
      
    Your ship lies in a crumpled heap at the top of a hill overlooking a high cliff.
    Yates is kneeled next to an open panel, attempting repairs. A winding
    path leads down to a humble little village.
      
    `),hasVisited()&&roll(50)&&msg(pick(["A big pink cloud poofs on by over the horizon.","A gentle breeze blows peacefully.","Some distant animal squawks mournfully from the valley below."])),btn({"Hey, Yates":talk("yates")}),btn({"Admire the view":`
  
  A wide sea stretches beyond the cliff's edge, sparkling in the bright crisp morning air.

  `}),btn({"Assess my ship":`
    
    It's a CM6305 Talon Class Explorer ship, fitting with your job as a space explorer-for-hire. For certain, it's seen better days,
    this morning's landing not withstanding. Currently, Yates ${pick(["has coolant spilled all over the hull","is tightening bolts on a rusted structural support","is pulling a fuel hose from under the engine"])}.
    
    `}),btn({"Enter the ship":go("mainDeck")}),btn({"Go down to the village":go("cityEntrance")})},Game.shipRepairShop=()=>{msg(`
       
    The road dips a bit and ends by a large wide building with a tall billboard, which reads: 

    <center>*SNORLAG SHIP REPAIR*</center>

    <center>Best spacecraft care anywhere</center>

    Attached to the door is a haphazardly scribbled scrap of a sign.
            
  `),btn({"Read the sign on the door":`
      
    <center>*Closed until the universe ends*</center>

  `}),btn({"Enter the repair shop":`
      
    The door is shut and locked tight.
      
  `}),btn({"Return to the village":go("city")})},Game.start=()=>{msg(`

    ## Everything Ends on
    # Snorlag
    
    ### A game by spaceflounder
    
    `),btn({Start:go("intro1")})},Game.intro1=()=>{msg(`

    There's a sound. It's not good. Your brain, still steeped in hyper-sleep chemicals, has come round to the point
    where you're awake and something has gone woefully awry.

    It's an alarm. An alarm is ringing from the engine.

    The hyper-sleep containment unit swings open and your feet find the cold metal floor. The air of your ship is 
    thick with smoke.

    You make out some text in screamy caps on a command display:

    <div class='console'>
    ALL SYSTEMS FAILED
    </div>

    <div class='console'>
    COLLISION WITH PLANET SNORLAG IMMINENT
    </div>
    
    <div class='console'>
    WE'RE ALL GONNA DIE!!
    </div>
    
    `),btn({"Ugghh... It's too early for an emergency...":go("intro2")})},Game.intro2=()=>{msg(`
          
    Then another sound: this one is sudden and shakes the entire ship. You grasp a bulkhead and nearly slice your fingers on
    the cheap titanium bolts holding your ship together. Another shake, like being inside a dump truck that's currently
    in the process of traversing to Mars by catapult.

    After that, everything is still. The alarm is still ringing. Your engineer, and the only member of your crew, Yates,
    emerges into your still blurry vision.
          
    `),btn({"Yates! What happened?":go("intro3")})},Game.intro3=()=>{msg(`
          
    "Sorry, boss," said Yates with a noisy slurp. He was drinking something. In his grip was a ginormous can of raspberry soda pop,
    festooned with a cherry-red flamingo straw.

    "Not sure how it happened, but somebody spilled raspberry soda all over the engine core. Had to make an emergency landing till
    we can fix this rig. Shouldn't be more than a couple of weeks.
          
    `),btn({"Did you say two weeks?":go("outsideShip")})};const once=e=>{let t=Object.keys(e)[0];const a="d"+function(){var e=0;if(0!=t.length)for(i=0;i<t.length;i++)e=(e<<5)-e+(char=t.charCodeAt(i)),e&=e;return e}();var o;g$[a]||((o={})[t]=()=>{g$[a]=!0,"function"==typeof e[t]?e[t]():msg(e[t])},btn(o))},style=`

button {
  border-radius: 0.25em;
  border: 1px solid transparent;
  padding: 0.6em;
  width: 100%;
  max-width: 100%;
  background-color: #1a1a1a;
  cursor: pointer;
  display: flex;
  text-indent: 0px;
  justify-content: center;
  align-items: center;
  margin-top: 1em;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

`,newStyle=`
  border-radius: 0.25em;
  border: 1px solid transparent;
  padding: 0.6em;
  width: 100%;
  max-width: 100%;
  background-color: #1a1a1a;
  cursor: pointer;
  display: flex;
  text-indent: 0px;
  justify-content: center;
  align-items: center;
  margin-top: 1em;
  transition: border-color 0.25s;
`,btn=e=>{var t=document.getElementById("btns");let o="",n=null;const a=["unshift"];if("object"==typeof e&&(o=Object.keys(e).filter(e=>-1===a.indexOf(e))[0],n=e[o]),!(t&&o&&n))throw"Button could not be constructed! With options: "+e;g$.buttonCount||(g$.buttonCount=0),g$.buttonCount+=1,o=o.trim();var i=document.createElement("button"),e=(i.type="button",i.onclick=()=>{var e,t=document.getElementsByClassName("main")[0].innerHTML,a=(document.getElementsByClassName("main")[0].remove(),window.scrollTo(0,0),g$.buttonCount=0,g$.isTalking&&(a=c$?.state??"talk",e=c$[a]["btn-"+o]??0,g$.lastButtonPressed=o,c$[a]["btn-"+o]=e+1),document.createElement("div"));a.className="outPage",a.innerHTML=t,document.body.appendChild(a),setTimeout(()=>{document.getElementsByClassName("outPage")[0].remove();var e=document.createElement("div"),t=(e.className="main",document.createElement("div")),a=(t.className="page",t.id="page",document.createElement("btns"));a.className="btns",a.id="btns",document.body.appendChild(e),e.appendChild(t),e.appendChild(a),"function"==typeof n?n():msg(n),!g$.env||!g$.isTalking&&g$.buttonCount||msg(g$.env()),!g$.buttonCount&&g$.lastNode&&btn({"➜":()=>{g$.lastNode&&g$.lastNode()}})},450)},i.className="button",i.innerHTML=`<div class='buttonText'>${skylight(o,!0)}</div>`,e.unshift);e?t.prepend(i):t.appendChild(i)},capitalize=e=>e[0].toUpperCase()+e.slice(1),timesPressed=(e,t,a)=>{return e=e||g$.lastButtonPressed,t=t||g$.isTalking,a=a||(c$.state??"talk"),g$[t][a]["btn-"+e]??0},hasSaid=(o,t,e)=>{t=t||g$.isTalking;var a=e=>{for(const t of e)if(Array.isArray(o)){for(const a of o)if(-1<t.indexOf(a))return!0}else if(-1<t.indexOf(o))return!0;return!1};if("*"!==(e=e||"*"))return a(Object.keys(g$[t][e]).filter(e=>"function"==typeof e).filter(e=>-1<e.indexOf("btn-")));for(const n of Object.keys(g$[t]))if(a(Object.keys(g$[t][n]).filter(e=>"number"==typeof g$[t][n][e]).filter(e=>-1<e.indexOf("btn-"))))return!0;return!1},getName=e=>{e=e||g$.isTalking;var t=g$[e].a??"a",a=g$[e].the??"the",o=g$[e].that??"that";return[g$[e].name??"person",t,a,o]},setName=(e,t)=>{t=t||g$.isTalking,g$[t].a="",g$[t].the="",g$[t].that="",g$[t].name=e},hasMet=e=>(e=e||g$.isTalking,g$[e].hasMet),getTalkLabel=e=>{e=e||g$.isTalking;var[t,,a,,]=getName(e);return g$[e].talkLabel?"string"==typeof g$[e].talkLabel?g$[e].talkLabel:g$[e].talkLabel():`Talk to ${a} `+t},getLocation=e=>{return(e?g$[e]:c$).location},setLocation=(e,t)=>{(t?g$[t]:c$).location=e},getDesc=e=>{e=e||g$.isTalking;var[t,,a]=getName(e),o=g$[e].state??"talk";if(!hasMet(e)&&g$[e].notMet){if("function"==typeof g$[e].notMet)return g$[e].notMet();if("object"==typeof g$[e].notMet&&g$[e].notMet[o]){if("function"==typeof g$[e].notMet[o])return g$[e].notMet[o]();if("string"==typeof g$[e].notMet[o])return g$[e].notMet[o]}return g$[e].notMet??capitalize(a+` ${t} is here.`)}if("function"==typeof g$[e].desc)return g$[e].desc();if("object"==typeof g$[e].desc&&g$[e].desc[o]){if("function"==typeof g$[e].desc[o])return g$[e].desc[o]();if("string"==typeof g$[e].desc[o])return g$[e].desc[o]}return g$[e].desc??capitalize(a+` ${t} is here.`)},setState=(e,t)=>{e=e??"talk";t=t||g$.isTalking,g$[t].state=e,g$.isTalking===t&&(g$.lastNode=g$[t][e])},hasVisited=e=>{return e=e||g$.currentLocationName,g$[e].visited??0},talk=t=>()=>{g$.isTalking=t,(c$=g$[t]).hasMet=!0;var e=c$?.state??"talk";g$[t][e](),g$.lastNode=g$[t][e]},done=(e,t)=>{var a={};a[e]=()=>{t?(t(),btn({"➜":()=>{go(g$.currentLocationName)(),g$.isTalking=""}})):(go(g$.currentLocationName)(),g$.isTalking="")},btn(a)},env=e=>{g$.env=e};let menuShown=!1;const toggleMenu=()=>{if(!menuShown){const a=document.createElement("div");a.className="menu";var e=document.createElement("div"),t=(e.style="max-width: 400px; display: flex; flex-direction: column; justify-content: space-evenly; align-items: center;",document.createElement("button"));t.style="aspect-ratio: 1; font-size: 24pt",t.innerText="🡹",t.onclick=()=>{menuShown=!1,a.remove()},e.appendChild(t),a.appendChild(e),document.body.appendChild(a)}},msg=e=>{if(Array.isArray(e)){var t=e;const n=t[0];var a="i"+(()=>{let e=0;if(0!=n.length)for(i=0;i<n.length;i++){var t=n.charCodeAt(i);e=(e<<5)-e+t,e&=e}return e})(),o=g$[a]??0;o?(msg(t[o]),o<t.length-1&&(g$[a]=o+1)):(g$[a]=1,msg(n))}else"string"==typeof e?document.getElementById("page").innerHTML+=skylight(e):"function"==typeof e&&(document.getElementById("page").innerHTML+=skylight(e()))},go=t=>{return()=>{g$.currentLocationName=t;var e=()=>{var e=g$[t]?.visited??0;g$.env=null,g$[t](),Object.keys(g$).map(e=>{var t;g$[e]?.location&&g$.currentLocationName===g$[e]?.location&&(t=getDesc(e),msg(t),g$[e].talk)&&((t={})[getTalkLabel(e)]=talk(e),t.unshift=!0,btn(t))}),g$[t].visited=e+1};e(),g$.lastNode=e}},shuffle=e=>{let t=e.length,a;for(;0!=t;)a=Math.floor(Math.random()*t),t--,[e[t],e[a]]=[e[a],e[t]];return e},roll=e=>e>=Math.floor(100*Math.random()),countdown=e=>1<e.length?e.pop():e[0],pick=e=>{e=[...e];return shuffle(e)[0]},getVal=e=>(g$.values||(g$.values={}),g$.values[e]??!1),setVal=(e,t)=>{g$.values||(g$.values={}),g$.values[e]=t};window.addEventListener("load",()=>{g$={...Game},go("start")()});